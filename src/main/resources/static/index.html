<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Document</title>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/rolling/css/rolling.css">
    <link rel="stylesheet" href="/stylesheets/style.css">

</head>
<body class="rooms">
<div class="scrollbar-macosx">
    <div class="header">
        <div class="toptext">
            <a href="#">
                <span class="glyphicon glyphicon-home"></span>
                <b>聊天室</b>
            </a>
        </div>
        <ul class="topnavlist">
            <li class="userinfo">
                <a><span class="glyphicon glyphicon-user"></span><b>用户名</b></a>
                <div class="popover fade bottom in">
                    <div class="arrow"></div>
                    <h3 class="popover-title">用户信息</h3>
                    <div class="popover-content">
                        <p class="user_portrait">
                            <img id="userinfo_img" ptimg="1" portrait_id="1" src="/images/user/1.png"
                                 alt="user_portrait">
                        </p>
                        <p class="select_portrait">
                            <img portrait_id="1" src="/images/user/1.png" alt="portrait_1" class="t">
                            <img portrait_id="2" src="/images/user/2.png" alt="portrait_1">
                            <img portrait_id="3" src="/images/user/3.png" alt="portrait_1">
                            <img portrait_id="4" src="/images/user/4.png" alt="portrait_1">
                            <img portrait_id="5" src="/images/user/5.png" alt="portrait_1">
                            <img portrait_id="6" src="/images/user/6.png" alt="portrait_1">
                            <img portrait_id="7" src="/images/user/7.png" alt="portrait_1">
                            <img portrait_id="8" src="/images/user/8.png" alt="portrait_1">
                            <img portrait_id="9" src="/images/user/9.png" alt="portrait_1">
                            <img portrait_id="10" src="/images/user/10.png" alt="portrait_1">
                            <img portrait_id="11" src="/images/user/11.png" alt="portrait_1">
                            <img portrait_id="12" src="/images/user/12.png" alt="portrait_1">
                        </p>
                        <p class="user_name">
                            <input id="userinfo_name" type="text" class="form-control" placeholder="用户名">
                            <button id="userinfo_sub" type="button" class="btn btn-primary btn-block">确定</button>
                        </p>
                    </div>
                </div>
            </li>
            <li class="theme">
                <a><span class="glyphicon glyphicon-leaf"></span><b>主题</b></a>
                <div class="popover fade bottom in">
                    <div class="arrow"></div>
                    <h3 class="popover-title">主题设置</h3>
                    <div class="popover-content">
                        <img theme_id="1" src="/images/theme/1_xs.jpg" alt="主题">
                        <img theme_id="2" src="/images/theme/2_xs.jpg" alt="主题">
                        <img theme_id="3" src="/images/theme/3_xs.jpg" alt="主题">
                        <img theme_id="4" src="/images/theme/4_xs.jpg" alt="主题">
                        <img theme_id="5" src="/images/theme/5_xs.jpg" alt="主题">
                        <img theme_id="6" src="/images/theme/6_xs.jpg" alt="主题">
                        <img theme_id="7" src="/images/theme/7_xs.jpg" alt="主题">
                        <img theme_id="8" src="/images/theme/8_xs.jpg" alt="主题">
                        <img theme_id="9" src="/images/theme/9_xs.jpg" alt="主题">
                        <img theme_id="10" src="/images/theme/10_xs.jpg" alt="主题">
                        <img theme_id="11" src="/images/theme/11_xs.jpg" alt="主题">
                        <img theme_id="12" src="/images/theme/12_xs.jpg" alt="主题">
                    </div>
                </div>
            </li>
        </ul>
        <div class="clapboard hidden"></div>
    </div>
    <div class="main container">
        <div class="room_list">
            <div class="col-xs-6 col-sm-6 col-md-4">
                <a href="javascript:void(0)" class="thumbnail chatroomHref" name="1">
                    <img src="/images/rooms/1.jpg" alt="聊天室1">
                    <span>
                        <span class='glyphicon glyphicon-user'></span>
                        <span id="chatroom1num">----</span>人
                    </span>
                </a>
            </div>
            <div class="col-xs-6 col-sm-6 col-md-4">
                <a href="javascript:void(0)" class="thumbnail chatroomHref" name="2">
                    <img src="/images/rooms/2.jpg" alt="聊天室2">
                    <span>
                        <span class='glyphicon glyphicon-user'></span>
                        <span id="chatroom2num">----</span>人
                    </span>
                </a>
            </div>
            <div class="col-xs-6 col-sm-6 col-md-4">
                <a href="javascript:void(0)" class="thumbnail chatroomHref" name="3">
                    <img src="/images/rooms/3.jpg" alt="聊天室3">
                    <span>
                        <span class='glyphicon glyphicon-user'></span>
                        <span id="chatroom3num">----</span>人
                    </span>
                </a>
            </div>
            <div class="col-xs-6 col-sm-6 col-md-4">
                <a href="javascript:void(0)" class="thumbnail chatroomHref" name="4">
                    <img src="/images/rooms/4.jpg" alt="聊天室4">
                    <span>
                        <span class='glyphicon glyphicon-user'></span>
                        <span id="chatroom4num">----</span>人
                    </span>
                </a>
            </div>
            <div class="col-xs-6 col-sm-6 col-md-4">
                <a href="javascript:void(0)" class="thumbnail chatroomHref" name="5">
                    <img src="/images/rooms/5.jpg" alt="聊天室5">
                    <span>
                        <span class='glyphicon glyphicon-user'></span>
                        <span id="chatroom5num">----</span>人
                    </span>
                </a>
            </div>
            <div class="col-xs-6 col-sm-6 col-md-4">
                <a href="javascript:void(0)" class="thumbnail chatroomHref" name="6">
                    <img src="/images/rooms/6.jpg" alt="聊天室6">
                    <span>
                        <span class='glyphicon glyphicon-user'></span>
                        <span id="chatroom6num">----</span>人
                    </span>
                </a>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="/javascripts/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/javascripts/jquery.cookie.js"></script>
<script type="text/javascript" src="/rolling/js/rolling.js"></script>
<script type="text/javascript" src="/javascripts/Public.js"></script>
<script type="text/javascript">
    var userName = $.cookie('userName');//从cookie取出username
    var userPortrait = $.cookie('userPortrait');//从cookie取出userPortrait

    $('.userinfo a b').text(userName); // 修改标题栏的用户昵称

    //初始化用户图片属性
    $('#userinfo_img').attr({
        "ptimg": userPortrait,
        "portrait_id": userPortrait,
        "src": "images/user/" + userPortrait + ".png"
    });

    
    //向后台请求每个聊天室的人数

    $(function(){

        $.ajax({
            //请求方式
            type : "GET",
            //请求的媒体类型
            contentType: "application/json;charset=UTF-8",
            //请求地址
            url : "/json/queryPeopleNumber",
            //请求成功
            success : function(result) {
                var jsonObj = result;
                $('#chatroom1num').html(jsonObj[0]);
                $('#chatroom2num').html(jsonObj[1]);
                $('#chatroom3num').html(jsonObj[2]);
                $('#chatroom4num').html(jsonObj[3]);
                $('#chatroom5num').html(jsonObj[4]);
                $('#chatroom6num').html(jsonObj[5]);
            },
            //请求失败，包含具体的错误信息
            error : function(e){
                alert("无法获取各个聊天室人数");
            }
        });
    },10000);



    //页面跳转
    $('a.chatroomHref').click(function () {
        //将房号附在请求参数中，传给后台，方便后台统计每个房间人数，以及记录用户列表
        window.location.href = "room.html?room=" + this.name;
    });
    
    //初始化更改用户名框的默认名称
    var userinfo_name = $('#userinfo_name');
    userinfo_name.attr("placeholder", userName);

    //更改用户名操作
    $('#userinfo_sub').click(function (event) {
        var userName = userinfo_name.val(); // 用户昵称
        var userPortrait = $('.rooms .user_portrait img').attr('portrait_id'); // 用户头像id
        if (userName === '') { // 如果不填用户昵称，就是以前的昵称
            alert("用户名不能为空");
            userName = $('.rooms .user_name input').attr('placeholder');
        }
        //用户名和头像id存入cookie
        $.cookie('userName', userName);
        $.cookie('userPortrait', userPortrait);
        $('.userinfo a b').text(userName); // 修改标题栏的用户昵称
        userinfo_name.val(''); // 昵称输入框清空
        userinfo_name.attr('placeholder', userName); // 昵称输入框默认显示用户昵称
        $('.topnavlist .popover').not($(this).next('.popover')).removeClass('show'); // 关掉用户面板
        $('.clapboard').addClass('hidden'); // 关掉模糊背景
    });

    // 设置主题
    $('.theme img').click(function (event) {
        var theme_id = $(this).attr('theme_id');
        $('.clapboard').click(); // 关掉用户模糊背景
        $('body').css('background-image', 'url(images/theme/' + theme_id + '_bg.jpg)'); // 设置背景
    });


</script>


</body>
</html>